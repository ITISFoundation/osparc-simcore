
queue_rules:
  - name: default
    queue_conditions:
      # let Mergify know that the PR can be merged (added manually)
      - label=-automerge
      # block Mergify from merging the PR (added manually)
      - label!=-do-not-merge
    merge_conditions:
      # list of CI checks that need to pass in order for the PR to be merged
      - check-success=unit-tests
      - check-success=integration-tests
      - check-success=system-tests

      # Check for required reviews
      - "#approved-reviews-by>=2"  # Requires 2 approving reviews
      - "#changes-requested-reviews-by=0"  # No changes requested
      - "#review-threads-unresolved=0"  # All review threads resolved

      # Optional but recommended checks
      - base=master
      - -draft  # PR is not in draft state
      - -conflict  # No merge conflicts


pull_request_rules:
    - name: automatic update for PR ready to be merged
      conditions:
        - queue-name=default
        - label=-automerge
        - label!=-do-not-merge
      actions:
        update:

    - name: retry CI on failure
      conditions:
        - base=master
        - queue-name=default
        - label=-automerge
        - label!=-do-not-merge
        - or:
          - check-failure=unit-tests
          - check-failure=integration-tests
          - check-failure=system-tests
      actions:
        github_actions:
          workflow:
            dispatch:
            - workflow: .github/workflows/ci-testing-deploy.yml
