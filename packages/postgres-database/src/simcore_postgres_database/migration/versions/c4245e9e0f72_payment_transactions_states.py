"""payment transactions states

Revision ID: c4245e9e0f72
Revises: fc6ea424f586
Create Date: 2023-09-07 16:00:26.832441+00:00

"""
import sqlalchemy as sa
from alembic import op
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = "c4245e9e0f72"
down_revision = "fc6ea424f586"
branch_labels = None
depends_on = None


payment_transaction_state = postgresql.ENUM(
    "PENDING",
    "SUCCESS",
    "FAILED",
    "CANCELED",
    name="paymenttransactionstate",
)
payment_transaction_state.create(op.get_bind())


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column(
        "payments_transactions",
        sa.Column(
            "state",
            sa.Enum(
                "PENDING",
                "SUCCESS",
                "FAILED",
                "CANCELED",
                name="paymenttransactionstate",
            ),
            nullable=False,
            server_default="PENDING",
        ),
    )
    op.add_column(
        "payments_transactions", sa.Column("state_message", sa.Text(), nullable=True)
    )
    # ### end Alembic commands ###

    # NOTE: old data is completely discarded at this point
    op.drop_column("payments_transactions", "success")
    op.drop_column("payments_transactions", "errors")


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column(
        "payments_transactions",
        sa.Column("errors", sa.TEXT(), autoincrement=False, nullable=True),
    )
    op.add_column(
        "payments_transactions",
        sa.Column("success", sa.BOOLEAN(), autoincrement=False, nullable=True),
    )
    op.drop_column("payments_transactions", "state_message")
    op.drop_column("payments_transactions", "state")
    # ### end Alembic commands ###

    sa.Enum(name="paymenttransactionstate").drop(op.get_bind(), checkfirst=False)
