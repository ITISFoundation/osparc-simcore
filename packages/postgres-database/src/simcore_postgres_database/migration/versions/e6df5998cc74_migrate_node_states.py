"""migrate node states

Revision ID: e6df5998cc74
Revises: 772c01ca8a90
Create Date: 2021-02-16 14:28:23.296317+00:00

"""

import sqlalchemy as sa
from alembic import op

# revision identifiers, used by Alembic.
revision = "e6df5998cc74"
down_revision = "772c01ca8a90"
branch_labels = None
depends_on = None


def upgrade():
    op.execute(
        sa.DDL(
            """
UPDATE projects
    SET workbench = (regexp_replace(workbench::text, '"state": ("[^"]*")', '"state": {"currentStatus": \\1}', 'g'))::json
    WHERE workbench::text LIKE '%%state%%'
        """
        )
    )


def downgrade():
    ### commands auto generated by Alembic - please adjust! ###
    op.execute(
        sa.DDL(
            """
    UPDATE projects
        SET workbench = (regexp_replace(workbench::text, '"state": {("[^"]+": [^,]+, )*"currentStatus": ("[^"]+")}', '"state": \\2', 'g'))::json
        WHERE workbench::text LIKE '%%state%%'
            """
        )
    )


# ### end Alembic commands ###
