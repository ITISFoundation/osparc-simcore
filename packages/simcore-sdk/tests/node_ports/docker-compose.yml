version: '3.7'
services:
  #TODO: use same integration test framework as in web server instead of fixed docker-compose file
  apihub:
    image: ${DOCKER_REGISTRY:-itisfoundation}/apihub:${DOCKER_IMAGE_TAG:-latest}
    init: true
    ports:
      - '8043:8043'
  storage:
    image: ${DOCKER_REGISTRY:-itisfoundation}/storage:${DOCKER_IMAGE_TAG:-latest}
    init: true
    ports:
      - 11111:8080
    environment:
      - APIHUB_HOST=apihub
      - APIHUB_PORT=8043
      - POSTGRES_ENDPOINT=postgres:5432
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pwd
      - POSTGRES_DB=test
      - POSTGRES_HOST=postgres
      - POSTGRES_PORT=5432
      - S3_ENDPOINT=${S3_ENDPOINT}
      - S3_ACCESS_KEY=${S3_ACCESS_KEY}
      - S3_SECRET_KEY=${S3_SECRET_KEY}
      - S3_BUCKET_NAME=${S3_BUCKET_NAME}
      - S3_SECURE=0
      - BF_API_SECRET="none"
      - BF_API_KEY="none"
    restart: always
    depends_on:
      - postgres
      - apihub
 # DEPENDENCIES ----------------------------------------------------
  postgres:
    restart: always
    image: postgres:10
    init: true
    environment:
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pwd
      - POSTGRES_DB=test
    ports:
      - "5432:5432"
 # TOOLS -----------------------------------------------------------
  adminer:
    image: adminer
    init: true
    ports:
      - 18080:8080
    depends_on:
      - postgres
