services:
  adminer:
    depends_on:
    - postgres
    image: adminer
    ports:
    - published: 18080
      target: 8080
  apihub:
    build:
      context: C:\Develop\oSPARC_simcore
      dockerfile: services/apihub/Dockerfile
      target: development
    deploy:
      placement:
        constraints:
        - node.platform.os == linux
    image: services_apihub:dev
    ports:
    - published: 8043
      target: 8043
    volumes:
    - /c/Develop/oSPARC_simcore/api:/srv/http/api:rw
  director:
    build:
      args:
        DOCKER_GID_ARG: '1042'
      context: C:\Develop\oSPARC_simcore
      dockerfile: services/director/Dockerfile
      target: development
    deploy:
      placement:
        constraints:
        - node.platform.os == linux
        - node.role == manager
    environment:
      POSTGRES_DB: simcoredb
      POSTGRES_ENDPOINT: postgres:5432
      POSTGRES_HOST: postgres
      POSTGRES_PASSWORD: simcore
      POSTGRES_PORT: '5432'
      POSTGRES_USER: simcore
      PUBLISHED_HOST_NAME: localhost
      RABBITMQ_LOG_CHANNEL: comp.backend.channels.log
      RABBITMQ_PASSWORD: simcore
      RABBITMQ_PROGRESS_CHANNEL: comp.backend.channels.progress
      RABBITMQ_USER: simcore
      REGISTRY_AUTH: "True"
      REGISTRY_PW: z43
      REGISTRY_URL: masu.speag.com
      REGISTRY_USER: z43
      RUN_DOCKER_ENGINE_ROOT: '1'
      S3_ACCESS_KEY: '12345678'
      S3_BUCKET_NAME: simcore
      S3_ENDPOINT: minio:9000
      S3_SECRET_KEY: '12345678'
      STORAGE_ENDPOINT: storage:8080
    image: services_director:dev
    ports:
    - published: 8001
      target: 8001
    volumes:
    - /c/Develop/oSPARC_simcore/services/director:/home/scu/services/director:rw
    - /var/run/docker.sock:/var/run/docker.sock:rw
  flower:
    command: --broker=amqp://simcore:simcore@rabbit:5672
    depends_on:
    - rabbit
    image: ondrejit/flower:latest
    ports:
    - published: 5555
      target: 5555
  minio:
    command: server /data
    environment:
      MINIO_ACCESS_KEY: '12345678'
      MINIO_SECRET_KEY: '12345678'
    image: minio/minio
    ports:
    - published: 9001
      target: 9000
  portainer:
    command: -H unix:///var/run/docker.sock
    image: portainer/portainer
    ports:
    - published: 9000
      target: 9000
    volumes:
    - portainer_data:/data:rw
    - /var/run/docker.sock:/var/run/docker.sock:rw
  postgres:
    environment:
      POSTGRES_DB: simcoredb
      POSTGRES_PASSWORD: simcore
      POSTGRES_USER: simcore
    image: postgres:10
    ports:
    - published: 5432
      target: 5432
    volumes:
    - postgres:/var/lib/postgresql/data:rw
  rabbit:
    environment:
      RABBITMQ_DEFAULT_PASS: simcore
      RABBITMQ_DEFAULT_USER: simcore
    image: rabbitmq:3-management
    ports:
    - published: 15672
      target: 15672
  registry:
    image: registry:2
    ports:
    - published: 5000
      target: 5000
    volumes:
    - registry:/var/lib/registry:rw
  sidecar:
    build:
      args:
        DOCKER_GID_ARG: '1042'
        HOST_GID_ARG: '1000'
      context: C:\Develop\oSPARC_simcore
      dockerfile: services/sidecar/Dockerfile
      target: development
    depends_on:
    - rabbit
    environment:
      POSTGRES_DB: simcoredb
      POSTGRES_ENDPOINT: postgres:5432
      POSTGRES_HOST: postgres
      POSTGRES_PASSWORD: simcore
      POSTGRES_PORT: '5432'
      POSTGRES_USER: simcore
      RABBITMQ_LOG_CHANNEL: comp.backend.channels.log
      RABBITMQ_PASSWORD: simcore
      RABBITMQ_PROGRESS_CHANNEL: comp.backend.channels.progress
      RABBITMQ_USER: simcore
      RUN_DOCKER_ENGINE_ROOT: '1'
      S3_ACCESS_KEY: '12345678'
      S3_BUCKET_NAME: simcore
      S3_ENDPOINT: minio:9000
      S3_SECRET_KEY: '12345678'
      STORAGE_ENDPOINT: storage:8080
    image: services_sidecar:dev
    ports:
    - published: 8000
      target: 8000
    volumes:
    - input:/home/scu/input:rw
    - log:/home/scu/log:rw
    - output:/home/scu/output:rw
    - /c/Develop/oSPARC_simcore/packages:/home/scu/packages:rw
    - /c/Develop/oSPARC_simcore/services/sidecar:/home/scu/services/sidecar:rw
    - /c/Develop/oSPARC_simcore/services/storage/client-sdk:/home/scu/services/storage/client-sdk:rw
    - /var/run/docker.sock:/var/run/docker.sock:rw
  storage:
    build:
      args:
        DOCKER_GID_ARG: '1042'
        HOST_GID_ARG: '1000'
      context: C:\Develop\oSPARC_simcore
      dockerfile: services/storage/Dockerfile
      target: development
    depends_on:
    - apihub
    - minio
    - postgres
    deploy:
      placement:
        constraints:
        - node.platform.os == linux
    environment:
      APIHUB_HOST: apihub
      APIHUB_PORT: '8043'
      BF_API_KEY: id_without_quotes
      BF_API_SECRET: id_without_quotes
      POSTGRES_DB: simcoredb
      POSTGRES_ENDPOINT: postgres:5432
      POSTGRES_HOST: postgres
      POSTGRES_PASSWORD: simcore
      POSTGRES_PORT: '5432'
      POSTGRES_USER: simcore
      RUN_DOCKER_ENGINE_ROOT: '1'
      S3_ACCESS_KEY: '12345678'
      S3_BUCKET_NAME: simcore
      S3_ENDPOINT: minio:9000
      S3_SECRET_KEY: '12345678'
    image: services_storage:dev
    ports:
    - published: 11111
      target: 8080
    volumes:
    - /c/Develop/oSPARC_simcore/packages:/home/scu/packages:rw
    - /c/Develop/oSPARC_simcore/services/storage:/home/scu/services/storage:rw
  webclient:
    build:
      context: C:\Develop\oSPARC_simcore\services\web\client
      dockerfile: Dockerfile
      target: development
    command: compile --watch
    deploy:
      placement:
        constraints:
        - node.platform.os == linux
    image: services_webclient:dev
    volumes:
    - /c/Develop/oSPARC_simcore/services/web/client:/home/scu/client:rw
  webserver:
    build:
      args:
        HOST_GID_ARG: '1000'
      context: C:\Develop\oSPARC_simcore
      dockerfile: services/web/Dockerfile
      target: development
    depends_on:
    - apihub
    - webclient
    deploy:
      placement:
        constraints:
        - node.platform.os == linux
    environment:
      APIHUB_HOST: apihub
      APIHUB_PORT: '8043'
      DIRECTOR_HOST: director
      DIRECTOR_PORT: '8001'
      OSPARC_PUBLIC_URL: http://localhost:9081
      POSTGRES_DB: simcoredb
      POSTGRES_ENDPOINT: postgres:5432
      POSTGRES_HOST: postgres
      POSTGRES_PASSWORD: simcore
      POSTGRES_PORT: '5432'
      POSTGRES_USER: simcore
      RABBITMQ_LOG_CHANNEL: comp.backend.channels.log
      RABBITMQ_PASSWORD: simcore
      RABBITMQ_PROGRESS_CHANNEL: comp.backend.channels.progress
      RABBITMQ_USER: simcore
      S3_ACCESS_KEY: '12345678'
      S3_BUCKET_NAME: simcore
      S3_ENDPOINT: minio:9000
      S3_SECRET_KEY: '12345678'
      SMTP_HOST: mail.speag.com
      SMTP_PORT: '25'
      STORAGE_HOST: storage
      STORAGE_PORT: '8080'
    image: services_webserver:dev
    ports:
    - published: 9081
      target: 8080
    volumes:
    - /c/Develop/oSPARC_simcore/packages:/home/scu/packages:rw
    - /c/Develop/oSPARC_simcore/services/web/client/source-output:/home/scu/services/web/client:rw
    - /c/Develop/oSPARC_simcore/services/web/server:/home/scu/services/web/server:rw
version: '3.4'
volumes:
  input: {}
  log: {}
  output: {}
  portainer_data: {}
  postgres: {}
  registry: {}

