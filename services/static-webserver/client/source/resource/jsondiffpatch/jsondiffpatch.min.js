(()=>{var De=Object.defineProperty;var Ne=(i,e)=>{for(var r in e)De(i,r,{get:e[r],enumerable:!0})};var le={};Ne(le,{DiffPatcher:()=>C,clone:()=>Xe,create:()=>Se,dateReviver:()=>P,diff:()=>We,patch:()=>Be,reverse:()=>qe,unpatch:()=>Ve});function P(i,e){var r,n,t,s,o,d;if(typeof e!="string")return e;let a=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d*))?(Z|([+-])(\d{2}):(\d{2}))$/.exec(e);return a?new Date(Date.UTC(Number.parseInt((r=a[1])!==null&&r!==void 0?r:"0",10),Number.parseInt((n=a[2])!==null&&n!==void 0?n:"0",10)-1,Number.parseInt((t=a[3])!==null&&t!==void 0?t:"0",10),Number.parseInt((s=a[4])!==null&&s!==void 0?s:"0",10),Number.parseInt((o=a[5])!==null&&o!==void 0?o:"0",10),Number.parseInt((d=a[6])!==null&&d!==void 0?d:"0",10),(a[7]?Number.parseInt(a[7]):0)||0)):e}function Ee(i){var e;let r=/^\/(.*)\/([gimyu]*)$/.exec(i.toString());if(!r)throw new Error("Invalid RegExp");return new RegExp((e=r[1])!==null&&e!==void 0?e:"",r[2])}function D(i){if(typeof i!="object")return i;if(i===null)return null;if(Array.isArray(i))return i.map(D);if(i instanceof Date)return new Date(i.getTime());if(i instanceof RegExp)return Ee(i);let e={};for(let r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=D(i[r]));return e}function me(i,e){if(i.length===0)throw new Error(e||"Expected a non-empty array")}function ye(i){return i.length>0}function ve(i){return i.length>=2}var ge=i=>i[i.length-1];var b=class{setResult(e){return this.result=e,this.hasResult=!0,this}exit(){return this.exiting=!0,this}push(e,r){return e.parent=this,typeof r<"u"&&(e.childName=r),e.root=this.root||this,e.options=e.options||this.options,this.children?(me(this.children),ge(this.children).next=e,this.children.push(e)):(this.children=[e],this.nextAfterChildren=this.next||null,this.next=e),e.next=this,this}};var M=class extends b{constructor(e,r){super(),this.left=e,this.right=r,this.pipe="diff"}prepareDeltaResult(e){var r,n,t,s;if(typeof e=="object"&&(!((r=this.options)===null||r===void 0)&&r.omitRemovedValues&&Array.isArray(e)&&e.length>1&&(e.length===2||e[2]===0||e[2]===3)&&(e[0]=0),!((n=this.options)===null||n===void 0)&&n.cloneDiffValues)){let o=typeof((t=this.options)===null||t===void 0?void 0:t.cloneDiffValues)=="function"?(s=this.options)===null||s===void 0?void 0:s.cloneDiffValues:D;typeof e[0]=="object"&&(e[0]=o(e[0])),typeof e[1]=="object"&&(e[1]=o(e[1]))}return e}setResult(e){return this.prepareDeltaResult(e),super.setResult(e)}},R=M;var k=class extends b{constructor(e,r){super(),this.left=e,this.delta=r,this.pipe="patch"}},A=k;var L=class extends b{constructor(e){super(),this.delta=e,this.pipe="reverse"}},x=L;var H=class{constructor(e){this.name=e,this.filters=[]}process(e){if(!this.processor)throw new Error("add this pipe to a processor before using it");let r=this.debug,n=this.filters.length,t=e;for(let s=0;s<n;s++){let o=this.filters[s];if(o&&(r&&this.log(`filter: ${o.filterName}`),o(t),typeof t=="object"&&t.exiting)){t.exiting=!1;break}}!t.next&&this.resultCheck&&this.resultCheck(t)}log(e){console.log(`[jsondiffpatch] ${this.name} pipe, ${e}`)}append(...e){return this.filters.push(...e),this}prepend(...e){return this.filters.unshift(...e),this}indexOf(e){if(!e)throw new Error("a filter name is required");for(let r=0;r<this.filters.length;r++){let n=this.filters[r];if(n?.filterName===e)return r}throw new Error(`filter not found: ${e}`)}list(){return this.filters.map(e=>e.filterName)}after(e,...r){let n=this.indexOf(e);return this.filters.splice(n+1,0,...r),this}before(e,...r){let n=this.indexOf(e);return this.filters.splice(n,0,...r),this}replace(e,...r){let n=this.indexOf(e);return this.filters.splice(n,1,...r),this}remove(e){let r=this.indexOf(e);return this.filters.splice(r,1),this}clear(){return this.filters.length=0,this}shouldHaveResult(e){return e===!1?(this.resultCheck=null,this):this.resultCheck?this:(this.resultCheck=r=>{if(!r.hasResult){console.log(r);let n=new Error(`${this.name} failed`);throw n.noResult=!0,n}},this)}},j=H;var S=class{constructor(e){this.selfOptions=e||{},this.pipes={}}options(e){return e&&(this.selfOptions=e),this.selfOptions}pipe(e,r){let n=r;if(typeof e=="string"){if(typeof n>"u")return this.pipes[e];this.pipes[e]=n}if(e&&e.name){if(n=e,n.processor===this)return n;this.pipes[n.name]=n}if(!n)throw new Error(`pipe is not defined: ${e}`);return n.processor=this,n}process(e,r){let n=e;n.options=this.options();let t=r||e.pipe||"default",s;for(;t;)typeof n.nextAfterChildren<"u"&&(n.next=n.nextAfterChildren,n.nextAfterChildren=null),typeof t=="string"&&(t=this.pipe(t)),t.process(n),s=t,t=null,n&&n.next&&(n=n.next,t=n.pipe||s);return n.hasResult?n.result:void 0}},we=S;var Ae=(i,e,r,n)=>i[r]===e[n],xe=(i,e,r,n)=>{var t,s,o;let d=i.length,a=e.length,u,h,c=new Array(d+1);for(u=0;u<d+1;u++){let f=new Array(a+1);for(h=0;h<a+1;h++)f[h]=0;c[u]=f}for(c.match=r,u=1;u<d+1;u++){let f=c[u];if(f===void 0)throw new Error("LCS matrix row is undefined");let l=c[u-1];if(l===void 0)throw new Error("LCS matrix row is undefined");for(h=1;h<a+1;h++)r(i,e,u-1,h-1,n)?f[h]=((t=l[h-1])!==null&&t!==void 0?t:0)+1:f[h]=Math.max((s=l[h])!==null&&s!==void 0?s:0,(o=f[h-1])!==null&&o!==void 0?o:0)}return c},Ie=(i,e,r,n)=>{let t=e.length,s=r.length,o={sequence:[],indices1:[],indices2:[]};for(;t!==0&&s!==0;){if(i.match===void 0)throw new Error("LCS matrix match function is undefined");if(i.match(e,r,t-1,s-1,n))o.sequence.unshift(e[t-1]),o.indices1.unshift(t-1),o.indices2.unshift(s-1),--t,--s;else{let a=i[t];if(a===void 0)throw new Error("LCS matrix row is undefined");let u=a[s-1];if(u===void 0)throw new Error("LCS matrix value is undefined");let h=i[t-1];if(h===void 0)throw new Error("LCS matrix row is undefined");let c=h[s];if(c===void 0)throw new Error("LCS matrix value is undefined");u>c?--s:--t}}return o},Te=(i,e,r,n)=>{let t=n||{},s=xe(i,e,r||Ae,t);return Ie(s,i,e,t)},Re={get:Te};var N=3;function $e(i,e,r,n){for(let t=0;t<r;t++){let s=i[t];for(let o=0;o<n;o++){let d=e[o];if(t!==o&&s===d)return!0}}return!1}function O(i,e,r,n,t){let s=i[r],o=e[n];if(s===o)return!0;if(typeof s!="object"||typeof o!="object")return!1;let d=t.objectHash;if(!d)return t.matchByPosition&&r===n;t.hashCache1=t.hashCache1||[];let a=t.hashCache1[r];if(typeof a>"u"&&(t.hashCache1[r]=a=d(s,r)),typeof a>"u")return!1;t.hashCache2=t.hashCache2||[];let u=t.hashCache2[n];return typeof u>"u"&&(t.hashCache2[n]=u=d(o,n)),typeof u>"u"?!1:a===u}var W=function(e){var r,n,t,s,o;if(!e.leftIsArray)return;let d={objectHash:(r=e.options)===null||r===void 0?void 0:r.objectHash,matchByPosition:(n=e.options)===null||n===void 0?void 0:n.matchByPosition},a=0,u=0,h,c,f,l=e.left,p=e.right,g=l.length,w=p.length,F;for(g>0&&w>0&&!d.objectHash&&typeof d.matchByPosition!="boolean"&&(d.matchByPosition=!$e(l,p,g,w));a<g&&a<w&&O(l,p,a,a,d);)h=a,F=new R(l[h],p[h]),e.push(F,h),a++;for(;u+a<g&&u+a<w&&O(l,p,g-1-u,w-1-u,d);)c=g-1-u,f=w-1-u,F=new R(l[c],p[f]),e.push(F,f),u++;let m;if(a+u===g){if(g===w){e.setResult(void 0).exit();return}for(m=m||{_t:"a"},h=a;h<w-u;h++)m[h]=[p[h]],e.prepareDeltaResult(m[h]);e.setResult(m).exit();return}if(a+u===w){for(m=m||{_t:"a"},h=a;h<g-u;h++){let v=`_${h}`;m[v]=[l[h],0,0],e.prepareDeltaResult(m[v])}e.setResult(m).exit();return}d.hashCache1=void 0,d.hashCache2=void 0;let ae=l.slice(a,g-u),de=p.slice(a,w-u),_=Re.get(ae,de,O,d),I=[];for(m=m||{_t:"a"},h=a;h<g-u;h++)if(_.indices1.indexOf(h-a)<0){let v=`_${h}`;m[v]=[l[h],0,0],e.prepareDeltaResult(m[v]),I.push(h)}let he=!0;!((t=e.options)===null||t===void 0)&&t.arrays&&e.options.arrays.detectMove===!1&&(he=!1);let ue=!1;!((o=(s=e.options)===null||s===void 0?void 0:s.arrays)===null||o===void 0)&&o.includeValueOnMove&&(ue=!0);let ce=I.length;for(h=a;h<w-u;h++){let v=_.indices2.indexOf(h-a);if(v<0){let pe=!1;if(he&&ce>0)for(let T=0;T<ce;T++){c=I[T];let $=c===void 0?void 0:m[`_${c}`];if(c!==void 0&&$&&O(ae,de,c-a,h-a,d)){$.splice(1,2,h,N),$.splice(1,2,h,N),ue||($[0]=""),f=h,F=new R(l[c],p[f]),e.push(F,f),I.splice(T,1),pe=!0;break}}pe||(m[h]=[p[h]],e.prepareDeltaResult(m[h]))}else{if(_.indices1[v]===void 0)throw new Error(`Invalid indexOnArray2: ${v}, seq.indices1: ${_.indices1}`);if(c=_.indices1[v]+a,_.indices2[v]===void 0)throw new Error(`Invalid indexOnArray2: ${v}, seq.indices2: ${_.indices2}`);f=_.indices2[v]+a,F=new R(l[c],p[f]),e.push(F,f)}}e.setResult(m).exit()};W.filterName="arrays";var be={numerically(i,e){return i-e},numericallyBy(i){return(e,r)=>e[i]-r[i]}},B=function(e){var r;if(!e.nested)return;let n=e.delta;if(n._t!=="a")return;let t,s,o=n,d=e.left,a=[],u=[],h=[];for(t in o)if(t!=="_t")if(t[0]==="_"){let l=t;if(o[l]!==void 0&&(o[l][2]===0||o[l][2]===N))a.push(Number.parseInt(t.slice(1),10));else throw new Error(`only removal or move can be applied at original array indices, invalid diff type: ${(r=o[l])===null||r===void 0?void 0:r[2]}`)}else{let l=t;o[l].length===1?u.push({index:Number.parseInt(l,10),value:o[l][0]}):h.push({index:Number.parseInt(l,10),delta:o[l]})}for(a=a.sort(be.numerically),t=a.length-1;t>=0;t--){if(s=a[t],s===void 0)continue;let l=o[`_${s}`],p=d.splice(s,1)[0];l?.[2]===N&&u.push({index:l[1],value:p})}u=u.sort(be.numericallyBy("index"));let c=u.length;for(t=0;t<c;t++){let l=u[t];l!==void 0&&d.splice(l.index,0,l.value)}let f=h.length;if(f>0)for(t=0;t<f;t++){let l=h[t];if(l===void 0)continue;let p=new A(d[l.index],l.delta);e.push(p,l.index)}if(!e.children){e.setResult(d).exit();return}e.exit()};B.filterName="arrays";var V=function(e){if(!e||!e.children||e.delta._t!=="a")return;let n=e.left,t=e.children.length;for(let s=0;s<t;s++){let o=e.children[s];if(o===void 0)continue;let d=o.childName;n[d]=o.result}e.setResult(n).exit()};V.filterName="arraysCollectChildren";var q=function(e){if(!e.nested){let t=e.delta;if(t[2]===N){let s=t;e.newName=`_${s[1]}`,e.setResult([s[0],Number.parseInt(e.childName.substring(1),10),N]).exit()}return}let r=e.delta;if(r._t!=="a")return;let n=r;for(let t in n){if(t==="_t")continue;let s=new x(n[t]);e.push(s,t)}e.exit()};q.filterName="arrays";var je=(i,e,r)=>{if(typeof e=="string"&&e[0]==="_")return Number.parseInt(e.substring(1),10);if(Array.isArray(r)&&r[2]===0)return`_${e}`;let n=+e;for(let t in i){let s=i[t];if(Array.isArray(s))if(s[2]===N){let o=Number.parseInt(t.substring(1),10),d=s[1];if(d===+e)return o;o<=n&&d>n?n++:o>=n&&d<n&&n--}else s[2]===0?Number.parseInt(t.substring(1),10)<=n&&n++:s.length===1&&Number.parseInt(t,10)<=n&&n--}return n},X=i=>{if(!i||!i.children)return;let e=i.delta;if(e._t!=="a")return;let r=e,n=i.children.length,t={_t:"a"};for(let s=0;s<n;s++){let o=i.children[s];if(o===void 0)continue;let d=o.newName;if(typeof d>"u"){if(o.childName===void 0)throw new Error("child.childName is undefined");d=je(r,o.childName,o.result)}t[d]!==o.result&&(t[d]=o.result)}i.setResult(t).exit()};X.filterName="arraysCollectChildren";var U=function(e){e.left instanceof Date?(e.right instanceof Date?e.left.getTime()!==e.right.getTime()?e.setResult([e.left,e.right]):e.setResult(void 0):e.setResult([e.left,e.right]),e.exit()):e.right instanceof Date&&e.setResult([e.left,e.right]).exit()};U.filterName="dates";var G=i=>{if(!i||!i.children)return;let e=i.children.length,r=i.result;for(let n=0;n<e;n++){let t=i.children[n];if(t!==void 0&&!(typeof t.result>"u")){if(r=r||{},t.childName===void 0)throw new Error("diff child.childName is undefined");r[t.childName]=t.result}}r&&i.leftIsArray&&(r._t="a"),i.setResult(r).exit()};G.filterName="collectChildren";var J=i=>{var e;if(i.leftIsArray||i.leftType!=="object")return;let r=i.left,n=i.right,t=(e=i.options)===null||e===void 0?void 0:e.propertyFilter;for(let s in r){if(!Object.prototype.hasOwnProperty.call(r,s)||t&&!t(s,i))continue;let o=new R(r[s],n[s]);i.push(o,s)}for(let s in n)if(Object.prototype.hasOwnProperty.call(n,s)&&!(t&&!t(s,i))&&typeof r[s]>"u"){let o=new R(void 0,n[s]);i.push(o,s)}if(!i.children||i.children.length===0){i.setResult(void 0).exit();return}i.exit()};J.filterName="objects";var Y=function(e){if(!e.nested)return;let r=e.delta;if(r._t)return;let n=r;for(let t in n){let s=new A(e.left[t],n[t]);e.push(s,t)}e.exit()};Y.filterName="objects";var Z=function(e){if(!e||!e.children||e.delta._t)return;let n=e.left,t=e.children.length;for(let s=0;s<t;s++){let o=e.children[s];if(o===void 0)continue;let d=o.childName;Object.prototype.hasOwnProperty.call(e.left,d)&&o.result===void 0?delete n[d]:n[d]!==o.result&&(n[d]=o.result)}e.setResult(n).exit()};Z.filterName="collectChildren";var z=function(e){if(!e.nested||e.delta._t)return;let n=e.delta;for(let t in n){let s=new x(n[t]);e.push(s,t)}e.exit()};z.filterName="objects";var K=i=>{if(!i||!i.children||i.delta._t)return;let r=i.children.length,n={};for(let t=0;t<r;t++){let s=i.children[t];if(s===void 0)continue;let o=s.childName;n[o]!==s.result&&(n[o]=s.result)}i.setResult(n).exit()};K.filterName="collectChildren";var Q=null;function Fe(i,e){var r;if(!Q){let n;if(!((r=i?.textDiff)===null||r===void 0)&&r.diffMatchPatch)n=new i.textDiff.diffMatchPatch;else{if(!e)return null;let t=new Error("The diff-match-patch library was not provided. Pass the library in through the options or use the `jsondiffpatch/with-text-diffs` entry-point.");throw t.diff_match_patch_not_found=!0,t}Q={diff:(t,s)=>n.patch_toText(n.patch_make(t,s)),patch:(t,s)=>{let o=n.patch_apply(n.patch_fromText(s),t);for(let d of o[1])if(!d){let a=new Error("text patch failed");throw a.textPatchFailed=!0,a}return o[0]}}}return Q}var ee=function(e){var r,n;if(e.leftType!=="string")return;let t=e.left,s=e.right,o=((n=(r=e.options)===null||r===void 0?void 0:r.textDiff)===null||n===void 0?void 0:n.minLength)||60;if(t.length<o||s.length<o){e.setResult([t,s]).exit();return}let d=Fe(e.options);if(!d){e.setResult([t,s]).exit();return}let a=d.diff;e.setResult([a(t,s),0,2]).exit()};ee.filterName="texts";var te=function(e){if(e.nested)return;let r=e.delta;if(r[2]!==2)return;let n=r,t=Fe(e.options,!0).patch;e.setResult(t(e.left,n[0])).exit()};te.filterName="texts";var ke=i=>{var e,r,n;let t=/^@@ +-(\d+),(\d+) +\+(\d+),(\d+) +@@$/,s=i.split(`
`);for(let o=0;o<s.length;o++){let d=s[o];if(d===void 0)continue;let a=d.slice(0,1);if(a==="@"){let u=t.exec(d);if(u!==null){let h=o;s[h]=`@@ -${u[3]},${u[4]} +${u[1]},${u[2]} @@`}}else if(a==="+"){if(s[o]=`-${(e=s[o])===null||e===void 0?void 0:e.slice(1)}`,((r=s[o-1])===null||r===void 0?void 0:r.slice(0,1))==="+"){let u=s[o];s[o]=s[o-1],s[o-1]=u}}else a==="-"&&(s[o]=`+${(n=s[o])===null||n===void 0?void 0:n.slice(1)}`)}return s.join(`
`)},re=function(e){if(e.nested)return;let r=e.delta;if(r[2]!==2)return;let n=r;e.setResult([ke(n[0]),0,2]).exit()};re.filterName="texts";var ie=function(e){if(e.left===e.right){e.setResult(void 0).exit();return}if(typeof e.left>"u"){if(typeof e.right=="function")throw new Error("functions are not supported");e.setResult([e.right]).exit();return}if(typeof e.right>"u"){e.setResult([e.left,0,0]).exit();return}if(typeof e.left=="function"||typeof e.right=="function")throw new Error("functions are not supported");if(e.leftType=e.left===null?"null":typeof e.left,e.rightType=e.right===null?"null":typeof e.right,e.leftType!==e.rightType){e.setResult([e.left,e.right]).exit();return}if(e.leftType==="boolean"||e.leftType==="number"){e.setResult([e.left,e.right]).exit();return}if(e.leftType==="object"&&(e.leftIsArray=Array.isArray(e.left)),e.rightType==="object"&&(e.rightIsArray=Array.isArray(e.right)),e.leftIsArray!==e.rightIsArray){e.setResult([e.left,e.right]).exit();return}e.left instanceof RegExp&&(e.right instanceof RegExp?e.setResult([e.left.toString(),e.right.toString()]).exit():e.setResult([e.left,e.right]).exit())};ie.filterName="trivial";var ne=function(e){if(typeof e.delta>"u"){e.setResult(e.left).exit();return}if(e.nested=!Array.isArray(e.delta),e.nested)return;let r=e.delta;if(r.length===1){e.setResult(r[0]).exit();return}if(r.length===2){if(e.left instanceof RegExp){let n=/^\/(.*)\/([gimyu]+)$/.exec(r[1]);if(n?.[1]){e.setResult(new RegExp(n[1],n[2])).exit();return}}e.setResult(r[1]).exit();return}r.length===3&&r[2]===0&&e.setResult(void 0).exit()};ne.filterName="trivial";var se=function(e){if(typeof e.delta>"u"){e.setResult(e.delta).exit();return}if(e.nested=!Array.isArray(e.delta),e.nested)return;let r=e.delta;if(r.length===1){e.setResult([r[0],0,0]).exit();return}if(r.length===2){e.setResult([r[1],r[0]]).exit();return}r.length===3&&r[2]===0&&e.setResult([r[0]]).exit()};se.filterName="trivial";var oe=class{constructor(e){this.processor=new we(e),this.processor.pipe(new j("diff").append(G,ie,U,ee,J,W).shouldHaveResult()),this.processor.pipe(new j("patch").append(Z,V,ne,te,Y,B).shouldHaveResult()),this.processor.pipe(new j("reverse").append(K,X,se,re,z,q).shouldHaveResult())}options(e){return this.processor.options(e)}diff(e,r){return this.processor.process(new R(e,r))}patch(e,r){return this.processor.process(new A(e,r))}reverse(e){return this.processor.process(new x(e))}unpatch(e,r){return this.patch(e,this.reverse(r))}clone(e){return D(e)}},C=oe;function Se(i){return new C(i)}var y;function We(i,e){return y||(y=new C),y.diff(i,e)}function Be(i,e){return y||(y=new C),y.patch(i,e)}function Ve(i,e){return y||(y=new C),y.unpatch(i,e)}function qe(i){return y||(y=new C),y.reverse(i)}function Xe(i){return y||(y=new C),y.clone(i)}var _e=i=>{let e=[],r=[...i],n=0;for(;r.length>0;){let{next:t,extra:s}=Ue(r);if(t.from!==t.to){e.push({from:t.from,to:t.to});for(let o of r){if(t.from===o.from)throw new Error("trying to move the same item twice");t.from<o.from&&o.from--,t.to<=o.from&&o.from++}}if(s){if(n++,n>100)throw new Error("failed to apply all array moves");r.push(s)}}return e},Ue=i=>{if(!ye(i))throw new Error("no more moves to make");if(!ve(i))return{next:i.shift()};let e=i[0],r=-1,n=i[0],t=-1;for(let f=0;f<i.length;f++){let l=i[f];l&&((r<0||l.to<e.to)&&(e=l,r=f),(t<0||l.to>n.to)&&(n=l,t=f))}let s=i[0],o=-1,d=i[0],a=-1;for(let f=0;f<i.length;f++){let l=i[f];l&&(f!==r&&(o<0||l.from<s.from)&&(s=l,o=f),f!==t&&(a<0||l.from>d.from)&&(d=l,a=f))}if(o<0||e.to<s.from||e.to<e.from&&e.to===s.from){let f=i.splice(r,1)[0];if(!f)throw new Error("failed to get next move");return{next:f}}if(a<0||n.to>d.from||n.to>n.from&&n.to===d.from){let f=i.splice(t,1)[0];if(!f)throw new Error("failed to get next move");return{next:f}}let u=i.splice(o,1)[0];if(!u)throw new Error("failed to get next move");let h=i.reduce((f,l)=>f+((l.to<u.to?-1:0)+(l.from<u.to?1:0)),0),c=u.to+h;return{next:{from:u.from,to:c},extra:{from:c,to:u.to}}};var E={add:"add",remove:"remove",replace:"replace",move:"move"},fe=class{format(e){let r=[],n=[{path:"",delta:e}];for(;n.length>0;){let t=n.pop();if(t===void 0||!t.delta)break;if(Array.isArray(t.delta)){if(t.delta.length===1&&r.push({op:E.add,path:t.path,value:t.delta[0]}),t.delta.length===2&&r.push({op:E.replace,path:t.path,value:t.delta[1]}),t.delta[2]===0&&r.push({op:E.remove,path:t.path}),t.delta[2]===2)throw new Error("JSONPatch (RFC 6902) doesn't support text diffs, disable textDiff option")}else if(t.delta._t==="a"){let s=t.delta,o=[],d=[],a=[],u=[];for(let c of Object.keys(s))if(c!=="_t")if(c.substring(0,1)==="_"){let f=Number.parseInt(c.substring(1)),l=s[c];if(!l)continue;Array.isArray(l)?l.length===3&&(l[2]===3?d.push({from:f,to:l[1]}):l[2]===0&&o.push(f)):u.push({to:f,delta:l})}else{let f=s[c],l=Number.parseInt(c);if(f){if(!Array.isArray(f))u.push({to:l,delta:f});else if(f.length===1)a.push({to:l,value:f[0]});else if(f.length===2)u.push({to:l,delta:f});else if(f.length===3&&f[2]===3)throw new Error("JSONPatch (RFC 6902) doesn't support text diffs, disable textDiff option")}}a.sort((c,f)=>c.to-f.to),o.sort((c,f)=>f-c);for(let c of o)if(r.push({op:E.remove,path:`${t.path}/${c}`}),d.length>0)for(let f of d)c<f.from&&f.from--;if(d.length>0){let c=[...a].reverse();for(let l of c)for(let p of d)l.to<p.to&&p.to--;let f=_e(d);for(let l of f)r.push({op:E.move,from:`${t.path}/${l.from}`,path:`${t.path}/${l.to}`})}for(let c of a){let{to:f,value:l}=c;r.push({op:E.add,path:`${t.path}/${f}`,value:l})}let h=[];for(let c of u){let{to:f,delta:l}=c;Array.isArray(l)?l.length===2&&r.push({op:E.replace,path:`${t.path}/${f}`,value:l[1]}):h.push({path:`${t.path}/${f}`,delta:l})}h.length>0&&n.push(...h.reverse())}else for(let s of Object.keys(t.delta).reverse()){let o=t.delta[s];n.push({path:`${t.path}/${Ge(s)}`,delta:o})}}return r}},Ce=fe;var Ge=i=>typeof i!="string"?i.toString():i.indexOf("/")===-1&&i.indexOf("~")===-1?i:i.replace(/~/g,"~0").replace(/\//g,"~1");window.jsondiffpatch=le;window.jsondiffpatch.formatters={jsonpatch:Ce};})();
