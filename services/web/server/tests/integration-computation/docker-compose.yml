services:
  apihub:
    image: services_apihub:latest
    ports:
    - 8043:8043
  director:
    environment:
    - REGISTRY_URL=masu.speag.com
    - REGISTRY_AUTH=True
    - REGISTRY_USER=z43
    - REGISTRY_PW=z43
    - POSTGRES_ENDPOINT=postgres:5432
    - POSTGRES_USER=simcore
    - POSTGRES_PASSWORD=simcore
    - POSTGRES_DB=simcoredb
    - POSTGRES_HOST=postgres
    - POSTGRES_PORT=5432
    - S3_ENDPOINT=minio:9000
    - S3_ACCESS_KEY=12345678
    - S3_SECRET_KEY=12345678
    - S3_BUCKET_NAME=simcore
    - STORAGE_ENDPOINT=storage:8080
    - RUN_DOCKER_ENGINE_ROOT=1
    - EXTRA_HOSTS_SUFFX=osparc.io
    - PUBLISHED_HOST_NAME=osparc01.itis.ethz.ch
    image: services_director:latest
    ports:
    - 8001:8001
    volumes:
    - /var/run/docker.sock:/var/run/docker.sock
  minio:
    command: server /data
    environment:
    - MINIO_ACCESS_KEY=12345678
    - MINIO_SECRET_KEY=12345678
    image: minio/minio
    ports:
    - 9001:9000
  postgres:
    environment:
    - POSTGRES_USER=simcore
    - POSTGRES_PASSWORD=simcore
    - POSTGRES_DB=simcoredb
    image: postgres:10
    ports:
    - 5432:5432
    volumes:
    - postgres:/var/lib/postgresql/data
  rabbit:
    environment:
    - RABBITMQ_DEFAULT_USER=simcore
    - RABBITMQ_DEFAULT_PASS=simcore
    image: rabbitmq:3-management
    ports:
    - 5672:5672
    - 15672:15672
  sidecar:
    depends_on:
    - rabbit
    environment:
    - RABBITMQ_USER=simcore
    - RABBITMQ_PASSWORD=simcore
    - POSTGRES_ENDPOINT=postgres:5432
    - POSTGRES_USER=simcore
    - POSTGRES_PASSWORD=simcore
    - POSTGRES_DB=simcoredb
    - POSTGRES_HOST=postgres
    - POSTGRES_PORT=5432
    - S3_ENDPOINT=minio:9000
    - S3_ACCESS_KEY=12345678
    - S3_SECRET_KEY=12345678
    - S3_BUCKET_NAME=simcore
    - STORAGE_ENDPOINT=storage:8080
    - RUN_DOCKER_ENGINE_ROOT=1
    image: services_sidecar:latest
    ports:
    - 8000:8000
    volumes:
    - input:/home/scu/input
    - output:/home/scu/output
    - log:/home/scu/log
    - /var/run/docker.sock:/var/run/docker.sock
  storage:
    depends_on:
    - minio
    - postgres
    - apihub
    environment:
    - APIHUB_HOST=apihub
    - APIHUB_PORT=8043
    - POSTGRES_ENDPOINT=postgres:5432
    - POSTGRES_USER=simcore
    - POSTGRES_PASSWORD=simcore
    - POSTGRES_DB=simcoredb
    - POSTGRES_HOST=postgres
    - POSTGRES_PORT=5432
    - S3_ENDPOINT=minio:9000
    - S3_ACCESS_KEY=12345678
    - S3_SECRET_KEY=12345678
    - S3_BUCKET_NAME=simcore
    - S3_SECURE=0
    - RUN_DOCKER_ENGINE_ROOT=1
    - BF_API_SECRET=none
    - BF_API_KEY=none
    image: services_storage:latest
    ports:
    - 11111:8080
    stdin_open: true
    tty: true
version: '3.4'
volumes:
  input: null
  log: null
  output: null
  postgres: null
  registry: null
