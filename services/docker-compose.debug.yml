# USAGE:  docker-compose -f docker-compose.yml -f docker-compose.debug.yml ...
version: '3.4'
services:
  director:
    image: services_director:dev
    build:
      target: development
    volumes:
      - './director/source:/home/app/source'
  #--------------------------------------------------------------------
  webserver:
    image: services_webserver:dev
    build:
      target: development
    ports:
      - '9081:8080'
      #- '9082:9082'
    environment:
      - DIRECTOR_HOST=director
      - DIRECTOR_PORT=8001
      - SIMCORE_WEB_CONFIG=development
    volumes:
      - './web/server/source:/usr/src/source'
      - './web/client/source-output:/usr/src/source/client'
      - './web/server/test:/usr/src/test'
      # TODO: do test go in production or development or debug??
    #depends_on:
    #  - build-qx
  #--------------------------------------------------------------------
  build-qx:
    image: itisfoundation/qooxdoo-compiler:latest
    volumes:
      - './web/client:/home/node/src'
    ports:
      - '8080:8080'
    working_dir: /home/node/src
    entrypoint: /bin/bash
    command: -c "qx contrib update && qx contrib list && qx contrib install ITISFoundation/qx-osparc-theme && qx compile --watch"
