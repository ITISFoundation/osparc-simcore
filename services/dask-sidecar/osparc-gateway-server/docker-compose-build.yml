version: "3.9"
services:
  osparc-gateway-server:
    image: local/osparc-gateway-server:${BUILD_TARGET:?build_target_required}
    build:
      context: ./
      dockerfile: Dockerfile
      cache_from:
        - local/osparc-gateway-server:${BUILD_TARGET:?build_target_required}
        - ${DOCKER_REGISTRY:-itisfoundation}/osparc-gateway-server:master-github-latest
        - ${DOCKER_REGISTRY:-itisfoundation}/osparc-gateway-server:staging-github-latest
        - ${DOCKER_REGISTRY:-itisfoundation}/osparc-gateway-server:release-github-latest
      target: ${BUILD_TARGET:?build_target_required}
      labels:
        org.opencontainers.image.created: "${BUILD_DATE}"
        org.opencontainers.image.source: "${VCS_URL}"
        org.opencontainers.image.revision: "${VCS_REF}"
