# USAGE:  docker-compose -f docker-compose.yml -f docker-compose.debug.yml ...
version: '3.4'
services:
  director:
    image: services_director:dev
    build:
      target: development
    volumes:
      - './director/source:/home/app/source'
  #--------------------------------------------------------------------
  webserver:
    image: services_webserver:dev
    build:
      #target: development
      target: common-py-stage
    ports:
      - '9081:8080'
    environment:
      - DIRECTOR_HOST=director
      - DIRECTOR_PORT=8001
      - SIMCORE_WEB_CONFIG=development
    volumes:
      # FIXME: For the moment, client's source is copied also in dev
      # - './web/client/source-output:/usr/src/source/client'
      - './web/server/src:/usr/src/source'
      - './web/server/tests:/usr/src/tests'
      # TODO: consider pip install git:
      - ../packages:/usr/src/packages
  #------------comp. backend-------------------------------------------
  sidecar:
    image: services_sidecar:dev
    build:
      target: development
    volumes:
      - ./sidecar/src/sidecar:/work/sidecar
      - ../packages:/work/packages
